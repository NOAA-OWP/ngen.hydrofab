---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(glue)
base = '/Volumes/Transcend/ngen/CONUS-hydrofabric/'
VPU = "01"
outfile = glue("{base}nextgen/nextgen_{VPU}.gpkg")
dir = glue("{base}nextgen/nextgen_{VPU}")

```

# ngen.hydrofab: Fabricating Hydrofabrics for use with NextGen <img src='man/figures/imgfile.png' align="right" height="139" />

<!-- badges: start -->
[![Dependencies](https://img.shields.io/badge/dependencies-16/91-red?style=flat)](#)
<!-- badges: end -->

The goal of `ngen.hydrofab` is to provide consistent hydrologic and hydraulic network manipulation tool chains to build nextgen ready hydrofabric products.


```{r, eval = FALSE}

library('hydrofab')
library('ngen.hydrofab')
library('glue')

base = '/Volumes/Transcend/ngen/CONUS-hydrofabric/'
VPU = "01"

outfile = glue("{base}nextgen/nextgen_{VPU}.gpkg")


ngen = get_hydrofabric(VPU = VPU, 
                type = "uniform",
                dir = glue("{base}uniform"),
                overwrite = FALSE) %>% 
  apply_nexus_topology()


ngen$flowpath_attributes <-  length_average_routelink(flowpaths = ngen$flowpaths,
                                                     rl_path = get_routelink_path())

outfile = write_hydrofabric(ngen, outfile)

aggregate_cfe_noahowp(gpkg                = outfile,
                      dir                 = '/Volumes/Transcend/nwmCONUS-v216/',
                      add_to_gpkg         = TRUE,
                      add_weights_to_gpkg = TRUE,
                      log                 = TRUE)

add_grid_mapping(gpkg      = outfile,
                 template  = "/Users/mjohnson/Downloads/AORC-OWP_2012063021z.nc4",
                 grid_name = "aorc_weights",
                 log       = TRUE)}
```

```{r}
sf::st_layers(outfile)
```

```{r, eval = FALSE}
write_ngen_dir(gpkg = outfile, dir = glue("{base}nextgen/nextgen_{VPU}"))
```

```{r}
fs::dir_tree(dir)
```
